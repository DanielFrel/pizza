{"ast":null,"code":"import _toConsumableArray from\"C:/DS/programming/react-pizza/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _objectSpread from\"C:/DS/programming/react-pizza/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _regeneratorRuntime from\"C:/DS/programming/react-pizza/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/DS/programming/react-pizza/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import React from\"react\";import{useSelector}from\"react-redux\";import{useNavigate}from\"react-router-dom\";import Categories from\"../components/Categories\";import Sort,{sortList}from\"../components/Sort\";import PizzaBlock from\"../components/PizzaBlock\";import Skeleton from\"../components/PizzaBlock/Skeleton\";import Pagination from\"../components/Pagination\";import{setCategoryId,setCurrentPage,setFiltrs}from\"../redux/filter/slice\";import{SearchContext}from\"../App\";import qs from\"qs\";import{useAppDispatch}from\"../redux/store\";import{selectFilter}from\"../redux/filter/selectors\";import{fetchPizzas}from\"../redux/pizza/asyncActions\";import{selectPizzaData}from\"../redux/pizza/selectors\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Home=function Home(){var navigate=useNavigate();var dispatch=useAppDispatch();var isSearch=React.useRef(false);var isMounted=React.useRef(false);var _useSelector=useSelector(selectFilter),categoryId=_useSelector.categoryId,sort=_useSelector.sort,currentPage=_useSelector.currentPage;var _useSelector2=useSelector(selectPizzaData),items=_useSelector2.items,status=_useSelector2.status;var _React$useContext=React.useContext(SearchContext),serachValue=_React$useContext.serachValue;//\nvar onChangeCategory=React.useCallback(function(inx){dispatch(setCategoryId(inx));},[]);var onChangePage=function onChangePage(page){dispatch(setCurrentPage(page));};var getPizzas=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var sortBy,order,category,search;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:sortBy=sort.sortProperty.replace(\"-\",\"\");order=sort.sortProperty.includes(\"-\")?\"asc\":\"desc\";category=categoryId>0?\"category=\".concat(categoryId):\"\";search=serachValue?\"&search=\".concat(serachValue):\"\";dispatch(fetchPizzas({sortBy:sortBy,order:order,category:category,search:search,currentPage:String(currentPage)}));window.scrollTo(0,0);case 6:case\"end\":return _context.stop();}}},_callee);}));return function getPizzas(){return _ref.apply(this,arguments);};}();//Если изменили параметры и был первый рендер\nReact.useEffect(function(){if(isMounted.current){var queryString=qs.stringify({sortProperty:sort.sortProperty,categoryId:categoryId,currentPage:currentPage});navigate(\"?\".concat(queryString));}isMounted.current=true;},[categoryId,sort.sortProperty,currentPage]);//Если был первый рендер, то проверяем  URL-параменты и сохраняем в редаксе\nReact.useEffect(function(){if(window.location.search){var params=qs.parse(window.location.search.substring(1));var _sort=sortList.find(function(obj){return obj.sortProperty===params.sortBy;});dispatch(setFiltrs({// ...params,\nsearchValue:params.search,categoryId:Number(params.category),currentPage:Number(params.currentPage),sort:_sort||sortList[0]}));isSearch.current=true;}},[]);//Если был первый рендер, то запрашиваем пиццы\nReact.useEffect(function(){window.scrollTo(0,0);if(!isSearch.current){getPizzas();}isSearch.current=false;},[categoryId,sort.sortProperty,serachValue,currentPage]);var pizzas=items.map(function(obj){return/*#__PURE__*/_jsx(PizzaBlock,_objectSpread({},obj),obj.id);});var skeletons=_toConsumableArray(new Array(6)).map(function(_,index){return/*#__PURE__*/_jsx(Skeleton,{},index);});return/*#__PURE__*/_jsxs(\"div\",{className:\"container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"content__top\",children:[/*#__PURE__*/_jsx(Categories,{value:categoryId,onChangeCategory:onChangeCategory}),/*#__PURE__*/_jsx(Sort,{value:sort})]}),/*#__PURE__*/_jsx(\"h2\",{className:\"content__title\",children:\"\\u0412\\u0441\\u0435 \\u043F\\u0438\\u0446\\u0446\\u044B\"}),status===\"error\"?/*#__PURE__*/_jsxs(\"div\",{className:\"content__error-info\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\u041F\\u0440\\u043E\\u0438\\u0437\\u043E\\u0448\\u043B\\u0430 \\u043E\\u0448\\u0438\\u0431\\u043A\\u0430 \\uD83D\\uDE15\"}),/*#__PURE__*/_jsx(\"p\",{children:\"\\u041D\\u0435 \\u0443\\u0434\\u0430\\u043B\\u043E\\u0441\\u044C \\u043F\\u043E\\u043B\\u0443\\u0447\\u0438\\u0442\\u044C \\u043F\\u0438\\u0446\\u0446\\u044B. \\u041F\\u043E\\u043F\\u0440\\u043E\\u0431\\u0443\\u0439\\u0442\\u0435 \\u043F\\u043E\\u0432\\u0442\\u043E\\u0440\\u0438\\u0442\\u044C \\u043F\\u043E\\u043F\\u044B\\u0442\\u043A\\u0443 \\u043F\\u043E\\u0437\\u0436\\u0435\"})]}):/*#__PURE__*/_jsx(\"div\",{className:\"content__items\",children:status===\"loading\"?skeletons:pizzas}),/*#__PURE__*/_jsx(Pagination,{currentPage:currentPage,onChangePage:onChangePage})]});};export default Home;","map":{"version":3,"names":["React","useSelector","useNavigate","Categories","Sort","sortList","PizzaBlock","Skeleton","Pagination","setCategoryId","setCurrentPage","setFiltrs","SearchContext","qs","useAppDispatch","selectFilter","fetchPizzas","selectPizzaData","Home","navigate","dispatch","isSearch","useRef","isMounted","categoryId","sort","currentPage","items","status","useContext","serachValue","onChangeCategory","useCallback","inx","onChangePage","page","getPizzas","sortBy","sortProperty","replace","order","includes","category","search","String","window","scrollTo","useEffect","current","queryString","stringify","location","params","parse","substring","find","obj","searchValue","Number","pizzas","map","id","skeletons","Array","_","index"],"sources":["C:/DS/programming/react-pizza/src/pages/Home.tsx"],"sourcesContent":["import React from \"react\";\r\n\r\nimport {useSelector } from \"react-redux\";\r\n\r\nimport {useNavigate } from \"react-router-dom\";\r\nimport Categories from \"../components/Categories\";\r\nimport Sort, { sortList } from \"../components/Sort\";\r\nimport PizzaBlock from \"../components/PizzaBlock\";\r\nimport Skeleton from \"../components/PizzaBlock/Skeleton\";\r\n\r\nimport Pagination from \"../components/Pagination\";\r\nimport {\r\n  setCategoryId,\r\n  setCurrentPage,\r\n  setFiltrs,\r\n} from \"../redux/filter/slice\";\r\n\r\nimport { SearchContext } from \"../App\";\r\nimport qs from \"qs\";\r\nimport { useAppDispatch } from \"../redux/store\";\r\nimport { selectFilter } from \"../redux/filter/selectors\";\r\nimport { fetchPizzas } from \"../redux/pizza/asyncActions\";\r\nimport { SearchPizzaParams } from \"../redux/pizza/types\";\r\nimport { selectPizzaData } from \"../redux/pizza/selectors\";\r\n\r\nconst Home: React.FC = () => {\r\n  const navigate = useNavigate();\r\n  const dispatch = useAppDispatch();\r\n  const isSearch = React.useRef(false);\r\n  const isMounted = React.useRef(false);\r\n\r\n  const {\r\n    categoryId,\r\n    sort,\r\n    currentPage,\r\n    // , serachValue\r\n  } = useSelector(selectFilter);\r\n  const { items, status } = useSelector(selectPizzaData);\r\n\r\n  const { serachValue } = React.useContext(SearchContext); //\r\n\r\n  const onChangeCategory = React.useCallback((inx: number) => {\r\n    dispatch(setCategoryId(inx));\r\n  }, []);\r\n\r\n  const onChangePage = (page: number) => {\r\n    dispatch(setCurrentPage(page));\r\n  };\r\n\r\n  const getPizzas = async () => {\r\n    const sortBy = sort.sortProperty.replace(\"-\", \"\");\r\n    const order = sort.sortProperty.includes(\"-\") ? \"asc\" : \"desc\";\r\n    const category = categoryId > 0 ? `category=${categoryId}` : \"\";\r\n    const search = serachValue ? `&search=${serachValue}` : \"\";\r\n\r\n    dispatch(\r\n      fetchPizzas({\r\n        sortBy,\r\n        order,\r\n        category,\r\n        search,\r\n        currentPage: String(currentPage),\r\n      })\r\n    );\r\n\r\n    window.scrollTo(0, 0);\r\n  };\r\n\r\n  //Если изменили параметры и был первый рендер\r\n  React.useEffect(() => {\r\n    if (isMounted.current) {\r\n      const queryString = qs.stringify({\r\n        sortProperty: sort.sortProperty,\r\n        categoryId,\r\n        currentPage,\r\n      });\r\n\r\n      navigate(`?${queryString}`);\r\n    }\r\n    isMounted.current = true;\r\n  }, [categoryId, sort.sortProperty, currentPage]);\r\n\r\n  //Если был первый рендер, то проверяем  URL-параменты и сохраняем в редаксе\r\n  React.useEffect(() => {\r\n    if (window.location.search) {\r\n      const params = qs.parse(\r\n        window.location.search.substring(1)\r\n      ) as unknown as SearchPizzaParams;\r\n\r\n      const sort = sortList.find((obj) => obj.sortProperty === params.sortBy);\r\n      dispatch(\r\n        setFiltrs({\r\n          // ...params,\r\n          searchValue: params.search,\r\n          categoryId: Number(params.category),\r\n          currentPage: Number(params.currentPage),\r\n          sort: sort || sortList[0],\r\n        })\r\n      );\r\n      isSearch.current = true;\r\n    }\r\n  }, []);\r\n\r\n  //Если был первый рендер, то запрашиваем пиццы\r\n  React.useEffect(() => {\r\n    window.scrollTo(0, 0);\r\n\r\n    if (!isSearch.current) {\r\n      getPizzas();\r\n    }\r\n    isSearch.current = false;\r\n  }, [categoryId, sort.sortProperty, serachValue, currentPage]);\r\n\r\n  const pizzas = items.map((obj: any) => <PizzaBlock key={obj.id} {...obj} />);\r\n  const skeletons = [...new Array(6)].map((_, index) => (\r\n    <Skeleton key={index} />\r\n  ));\r\n\r\n  return (\r\n    <div className=\"container\">\r\n      <div className=\"content__top\">\r\n        <Categories value={categoryId} onChangeCategory={onChangeCategory} />\r\n        <Sort value={sort} />\r\n      </div>\r\n      <h2 className=\"content__title\">Все пиццы</h2>\r\n      {status === \"error\" ? (\r\n        <div className=\"content__error-info\">\r\n          <h2>Произошла ошибка 😕</h2>\r\n          <p>Не удалось получить пиццы. Попробуйте повторить попытку позже</p>\r\n        </div>\r\n      ) : (\r\n        <div className=\"content__items\">\r\n          {status === \"loading\" ? skeletons : pizzas}\r\n        </div>\r\n      )}\r\n      <Pagination currentPage={currentPage} onChangePage={onChangePage} />\r\n    </div>\r\n  );\r\n};\r\nexport default Home;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}